# Implementation Plan: Movie Theatrical Releases Tracker

**Branch**: `001-movie-releases` | **Date**: 2025-12-12 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/001-movie-releases/spec.md`

**Note**: This plan follows the Spec Kit workflow. Phase 0-1 completed by `/speckit.plan`, Phase 2 (tasks) generated by `/speckit.tasks`.

## Summary

Transform the existing OTT Weekly Releases application into a Movie Theatrical Releases Tracker by adapting the codebase to fetch and display theatrical movie releases for **last week, current week, and next week** in **US and India** markets. Reuse existing architecture (Perplexity API, vanilla HTML/CSS/JS, ISO week-based temporal organization) while changing data model from streaming platforms to theater distribution categories and implementing three-week temporal navigation instead of current week + archive model.

**Core Technical Approach**: Modify API prompts for theatrical releases, restructure data files to support three concurrent weeks (last/current/next), update frontend navigation for week-relative views, and adapt display logic for theater-specific organization categories.

## Technical Context

**Language/Version**: Node.js 18+ (CommonJS), TypeScript 5.x (Playwright tests only, no compilation)  
**Primary Dependencies**: Zero runtime dependencies - Playwright 1.48+ (dev/test only)  
**Storage**: Static JSON files in `data/{country}` directories (file-based, no database)  
**Testing**: Playwright Test Framework with TypeScript test files  
**Target Platform**: Static website - GitHub Pages / any static host  
**Project Type**: Single-page web application (static files, no build process)  
**Performance Goals**: FCP < 1.0s, LCP < 2.5s, TBT < 200ms, Page load < 2s on 3G  
**Constraints**: Zero runtime dependencies, works without JavaScript (progressive enhancement), file size < 100KB gzipped  
**Scale/Scope**: ~50-150 movie releases per week per country, 3 weeks × 2 countries = 6 JSON files simultaneously active

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### ✅ I. Zero-Dependency Static Architecture
- **Compliance**: PASS - Reusing existing vanilla HTML/CSS/JS architecture
- **Verification**: No new runtime dependencies introduced; Playwright remains dev-only
- **Justification**: N/A - Fully compliant

### ✅ II. Temporal Data Integrity
- **Compliance**: PASS - Maintains ISO week boundaries with three-week sliding window
- **Verification**: New data structure: `last-week.json`, `current-week.json`, `next-week.json` per country
- **Change from existing**: Previously used `current-week.json` + `archive/{weekid}.json`; now uses fixed three-week model
- **Justification**: Three-week model aligns with user stories (P1: current, P2: last week, P3: next week) and simplifies temporal navigation

### ✅ III. Test-First Development (NON-NEGOTIABLE)
- **Compliance**: PASS - All features will follow TDD gates (GATE 1 → GATE 2 → GATE 3)
- **Verification**: Tests in `tests/features/`, `tests/build/`, `tests/integration/` directories
- **Existing tests**: Leverage patterns from existing test files (e.g., `tests/features/html-structure.spec.ts`)

### ✅ IV. Automated Testing Coverage
- **Compliance**: PASS - Will maintain comprehensive Playwright test coverage
- **Verification**: Tests across all categories (features, build, browsers, mobile, performance)
- **Existing coverage**: 35 existing test files to adapt + new tests for three-week navigation

### ✅ V. Progressive Enhancement
- **Compliance**: PASS - Core content (current week movies) viewable without JavaScript
- **Verification**: HTML contains fallback content; JS enhances with navigation
- **Existing implementation**: Already uses progressive enhancement pattern in `index.html`

**Constitution Status**: ✅ **ALL GATES PASS** - Ready to proceed with Phase 0 research

## Project Structure

### Documentation (this feature)

```text
specs/001-movie-releases/
├── spec.md              # Feature specification (complete)
├── plan.md              # This file - Implementation plan
├── research.md          # Phase 0: Research findings (to be generated)
├── data-model.md        # Phase 1: Data entities and schemas (to be generated)
├── quickstart.md        # Phase 1: Developer quick-start guide (to be generated)
├── contracts/           # Phase 1: API contracts and data schemas (to be generated)
│   ├── movie-release-schema.json
│   ├── week-data-schema.json
│   └── api-prompt-template.md
└── tasks.md             # Phase 2: Detailed implementation tasks (to be generated by /speckit.tasks)
```

### Source Code (repository root)

**Current Structure** (existing OTT releases codebase):
```text
movie_releases/
├── index.html                    # Main HTML (MODIFY: Update for movies)
├── assets/
│   ├── css/
│   │   └── main.css             # Styles (MINOR UPDATES: Movie-specific styling)
│   ├── js/
│   │   └── app.js               # Frontend logic (MAJOR UPDATES: Three-week navigation)
│   └── images/
│       └── logos/                # Platform logos (REPLACE: Theater/distribution logos)
├── data/
│   ├── us/
│   │   ├── current-week.json    # KEEP: Current week movies
│   │   ├── last-week.json       # NEW: Previous week movies
│   │   ├── next-week.json       # NEW: Upcoming week movies
│   │   ├── archive/             # OPTIONAL: May deprecate or keep for historical data
│   │   └── archive-index.json   # OPTIONAL: May deprecate
│   └── india/
│       ├── current-week.json    # KEEP: Current week movies
│       ├── last-week.json       # NEW: Previous week movies
│       ├── next-week.json       # NEW: Upcoming week movies
│       ├── archive/             # OPTIONAL
│       └── archive-index.json   # OPTIONAL
├── scripts/
│   ├── fetch-releases.js        # MAJOR UPDATES: Change API prompts for movies, handle 3 weeks
│   └── utils/
│       ├── date-utils.js        # MINOR UPDATES: Add getPreviousWeek, getNextWeek helpers
│       ├── cache.js             # KEEP AS-IS: Already supports week-based caching
│       ├── error-handler.js     # KEEP AS-IS: No changes needed
│       └── week-transition.js   # MAJOR UPDATES: Handle three-week sliding window logic
├── tests/
│   ├── features/                # UPDATE: Adapt existing tests + add three-week navigation tests
│   ├── build/                   # UPDATE: Adapt date-utils and week-transition tests
│   ├── integration/             # NEW: Three-week data flow tests
│   ├── browsers/                # KEEP: Cross-browser compatibility tests
│   ├── mobile/                  # KEEP: Mobile responsive tests
│   └── performance/             # KEEP: Lighthouse performance tests
└── .github/
    └── workflows/
        └── update-deploy.yml    # MINOR UPDATES: Update job names (OTT → Movies)
```

**Structure Decision**: Single-page web application with static file organization. No build process, no module bundler. All files served directly. This matches the existing OTT releases architecture and maintains zero-dependency requirement.

## Complexity Tracking

> **No constitutional violations** - All principles satisfied. This section documents key technical decisions that introduce complexity:

### 1. Three-Week Temporal Model

**Complexity**: Managing three concurrent week files (last/current/next) vs previous two-file model (current + archives)

**Justification**: Required by user stories (US2: last week, US1: current week, US3: next week). Provides better UX for theatrical releases where users plan future visits and catch up on recent releases.

**Mitigation**: 
- Reuse existing week-transition.js patterns
- Add explicit week-type field (`"last-week"`, `"current-week"`, `"next-week"`) to each file
- Daily cron job updates all three files atomically

**Alternatives Considered**:
- Archive model: Rejected - archives are historical, not forward-looking; doesn't support "next week"
- Single file with three arrays: Rejected - violates temporal data integrity (separate files per week)

### 2. Country-Specific Organizational Categories

**Complexity**: US uses distribution categories (Wide Release, Limited, etc.); India uses language/industry (Bollywood, Tollywood, etc.)

**Justification**: Matches how users in each country conceptualize theatrical releases. Essential for usability per US4 user story.

**Mitigation**:
- Use consistent data model with `category_id` and `category_name` fields
- Frontend renders categories generically; API prompt tailors per country
- Configuration object in scripts/fetch-releases.js defines categories per country

**Alternatives Considered**:
- Single global categorization: Rejected - doesn't reflect regional theater ecosystems
- No categories (flat list): Rejected - poor UX for 50-150 movies per week

### 3. Perplexity API Prompt Adaptation

**Complexity**: Changing API prompts from "OTT streaming releases" to "theatrical movie releases" while maintaining data quality

**Justification**: Core requirement - switching from streaming to theatrical context

**Mitigation**:
- Leverage existing prompt structure from scripts/fetch-releases.js (lines 162-295)
- Test prompts iteratively to ensure consistent data quality
- Add validation for required fields (title, release_date, genre, theater_info)

**Alternatives Considered**:
- Different API service: Rejected - Perplexity API already proven to work for entertainment data
- Manual data entry: Rejected - defeats automation requirement (FR-016)

## Phase 0: Outline & Research

### Research Tasks

#### RT-001: Analyze Existing Week Transition Logic
**Objective**: Understand how current `week-transition.js` handles week boundaries and archiving

**Questions**:
- How does `shouldArchive()` detect new weeks?
- How are archive files named and organized?
- What happens at year boundaries (week 52 → week 1)?
- Can we adapt this for three-week sliding window?

**Output**: Document current archiving logic and propose three-week adaptation strategy

#### RT-002: Inventory Reusable vs Modifiable Components
**Objective**: Categorize all existing files by modification requirement

**Categories**:
- KEEP AS-IS: No changes (cache.js, error-handler.js)
- MINOR UPDATES: Small changes (date-utils.js, main.css, workflows)
- MAJOR UPDATES: Significant rewrites (fetch-releases.js, app.js, week-transition.js)
- NEW FILES: Create from scratch (last-week.json, next-week.json, new tests)

**Output**: Detailed inventory table with modification classification

#### RT-003: Three-Week Navigation UX Patterns
**Objective**: Research best practices for temporal navigation UI

**Questions**:
- How do calendar apps handle previous/current/next navigation?
- What visual indicators distinguish past/current/future content?
- How to make URL hash structure intuitive (#last-week/us, #current/india, #next-week/india)?

**Output**: UI/UX patterns document with navigation wireframes

#### RT-004: Theatrical Release Data Structure Research
**Objective**: Understand standard theatrical release metadata

**Questions**:
- What fields are standard for theatrical releases (vs streaming)?
- How do US distribution categories differ from India's regional industries?
- What theater chains are relevant for US display?
- What rating systems (MPAA, CBFC) to include?

**Output**: Movie release entity specification with all fields defined

#### RT-005: Perplexity API Prompt Engineering
**Objective**: Design effective prompts for theatrical movie data

**Questions**:
- How to query for "last week", "current week", "next week" releases?
- How to differentiate "new releases" from "still playing"?
- How to handle tentative dates for future week?
- What terminology ensures comprehensive coverage (wide release, limited release, indie)?

**Output**: Three prompt templates (US market, India market, with week context)

### Consolidation: research.md

All research findings will be consolidated into `specs/001-movie-releases/research.md` with the following structure:

```markdown
# Research: Movie Theatrical Releases Tracker

## Week Transition Logic Analysis
[Findings from RT-001]

## Component Modification Inventory
[Findings from RT-002 - table format]

## Navigation UX Patterns
[Findings from RT-003 - wireframes and patterns]

## Theatrical Release Data Model
[Findings from RT-004 - entity specification]

## API Prompt Templates
[Findings from RT-005 - three complete prompts]

## Technology Decisions
- Three-week model: Implementation approach
- Country categories: Configuration structure
- Hash routing: URL design pattern
```

**Output**: `research.md` with all NEEDS CLARIFICATION resolved

---

## Phase 1: Design & Contracts

**Prerequisites**: research.md complete

### 1. Extract Entities → data-model.md

Based on specification (FR-005, Key Entities section) and research findings:

**Entities to Document**:

#### Movie Release Entity
- Fields: title, release_date, genre, rating, runtime, cast[], director, language, theater_distribution_info, description, industry_region, poster_url
- Validation rules: title (required, string), release_date (required, ISO format or "TBA"), genre (required, string)
- State transitions: N/A (static data)
- Relationships: Belongs to Distribution Category, belongs to Week Data

#### Week Data Entity  
- Fields: week_number, year, week_id, week_start, week_end, week_range, week_title, week_type, country, generated_at, distribution_categories[]
- Validation rules: week_id (format: YYYY-WW), week_type (enum: last-week|current-week|next-week)
- State transitions: Transitions occur daily at 00:00 UTC Monday (next-week → current-week → last-week)
- Relationships: Contains multiple Distribution Categories

#### Distribution Category Entity
- Fields: category_id, category_name, releases[]
- Validation rules: category_id (kebab-case), releases (array of Movie Release)
- Relationships: Contains multiple Movie Releases, belongs to Week Data
- Country-specific categories:
  - **US**: wide-release, limited-release, independent, blockbuster
  - **India**: bollywood-hindi, tollywood-telugu, kollywood-tamil, mollywood-malayalam, sandalwood-kannada, regional

**Output**: `data-model.md` with complete entity specifications

### 2. Generate API Contracts

Based on functional requirements and research:

#### Contract 1: Week Data JSON Schema (`contracts/week-data-schema.json`)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["week_number", "year", "week_id", "week_type", "country", "generated_at", "distribution_categories"],
  "properties": {
    "week_number": {"type": "integer", "minimum": 1, "maximum": 53},
    "year": {"type": "integer"},
    "week_id": {"type": "string", "pattern": "^[0-9]{4}-[0-9]{2}$"},
    "week_start": {"type": "string", "format": "date"},
    "week_end": {"type": "string", "format": "date"},
    "week_range": {"type": "string"},
    "week_title": {"type": "string"},
    "week_type": {"type": "string", "enum": ["last-week", "current-week", "next-week"]},
    "country": {
      "type": "object",
      "required": ["id", "name", "flag"],
      "properties": {
        "id": {"type": "string", "enum": ["us", "india"]},
        "name": {"type": "string"},
        "flag": {"type": "string"}
      }
    },
    "generated_at": {"type": "string", "format": "date-time"},
    "distribution_categories": {
      "type": "array",
      "items": {"$ref": "#/definitions/DistributionCategory"}
    }
  },
  "definitions": {
    "DistributionCategory": {
      "type": "object",
      "required": ["category_id", "category_name", "releases"],
      "properties": {
        "category_id": {"type": "string"},
        "category_name": {"type": "string"},
        "releases": {
          "type": "array",
          "items": {"$ref": "#/definitions/MovieRelease"}
        }
      }
    },
    "MovieRelease": {
      "type": "object",
      "required": ["title", "release_date", "genre"],
      "properties": {
        "title": {"type": "string"},
        "release_date": {"type": "string"},
        "genre": {"type": "string"},
        "rating": {"type": "string"},
        "runtime": {"type": "integer"},
        "cast": {"type": "array", "items": {"type": "string"}},
        "director": {"type": "string"},
        "language": {"oneOf": [{"type": "string"}, {"type": "array", "items": {"type": "string"}}]},
        "theater_distribution_info": {"type": "string"},
        "description": {"type": "string"},
        "industry_region": {"type": "string"},
        "poster_url": {"type": "string", "format": "uri"}
      }
    }
  }
}
```

#### Contract 2: API Prompt Template (`contracts/api-prompt-template.md`)

Document the structure and parameters for Perplexity API prompts including:
- Week context parameter (last week, current week, next week with date ranges)
- Country-specific instructions
- Category definitions
- Expected JSON response format
- Validation requirements

**Output**: 
- `contracts/week-data-schema.json` - JSON Schema for validation
- `contracts/movie-release-schema.json` - Standalone movie release schema
- `contracts/api-prompt-template.md` - Prompt engineering documentation

### 3. Generate quickstart.md

Developer onboarding guide with:

```markdown
# Quick Start: Movie Theatrical Releases Tracker

## Prerequisites
- Node.js 18+
- Perplexity API key
- Git

## Setup (5 minutes)
1. Clone repository
2. Copy .env.example to .env, add PERPLEXITY_API_KEY
3. Run `npm install` (installs Playwright for testing)
4. Run `npm start` (starts local server on port 3000)

## Development Workflow
1. Branch from main (or feature branch)
2. TDD: Write failing test first
3. Implement feature
4. Verify test passes
5. Run full test suite: `npm test`
6. Commit + push

## Key Files to Know
- `scripts/fetch-releases.js` - API integration
- `assets/js/app.js` - Frontend navigation logic
- `scripts/utils/week-transition.js` - Three-week sliding window
- `data/{country}/{week-type}.json` - Data files

## Testing
- Run all tests: `npm test`
- Run feature tests: `npm run test:e2e`
- Run build tests: `npm run test:unit`
- Test with UI: `npm run test:ui`

## Common Tasks
- Fetch data manually: `node scripts/fetch-releases.js`
- Validate JSON: `npm run validate-json`
- Deploy: Push to main (GitHub Actions handles deployment)
```

**Output**: `quickstart.md` for rapid developer onboarding

### 4. Agent Context Update

Run `.specify/scripts/powershell/update-agent-context.ps1 -AgentType copilot` to update Copilot instructions with:
- New technology: "Theatrical movie releases" (add to context)
- Temporal model: "Three-week sliding window (last/current/next)"
- Data structure: "Theater distribution categories"
- Preserve manual additions between markers

**Output**: Updated `.github/copilot-instructions.md` or `.cursor/rules`

### 5. Re-evaluate Constitution Check

Post-design verification:

✅ **I. Zero-Dependency Static Architecture** - STILL COMPLIANT
- No new dependencies introduced in design
- Reusing existing vanilla JS patterns

✅ **II. Temporal Data Integrity** - STILL COMPLIANT  
- Three-week model maintains ISO week boundaries
- Each file has distinct week_type field
- Files never overlap or corrupt

✅ **III-V. TDD, Testing, Progressive Enhancement** - STILL COMPLIANT
- Design supports all testing strategies
- Progressive enhancement preserved (HTML fallback)

**Post-Design Status**: ✅ **ALL GATES STILL PASS**

---

## Phase 2: Tasks Generation

**Note**: Phase 2 (tasks.md) is generated by `/speckit.tasks` command, NOT by `/speckit.plan`.

The tasks.md file will contain:
- Detailed implementation tasks organized by user story priority
- TDD test tasks (marked as GATE 1 prerequisites)
- Implementation tasks (depends on tests failing)
- Verification tasks (GATE 2 - tests passing)
- Task dependencies and parallelization opportunities

**Next Command**: `/speckit.tasks` (after research and design phases complete)

---

## Key Decisions Summary

| Decision | Choice | Rationale |
|----------|--------|-----------|
| **Temporal Model** | Three concurrent files (last/current/next) | Supports US2 (last week), US1 (current), US3 (next week) |
| **Data Structure** | `data/{country}/{week-type}.json` | Clear separation, easy to cache, follows existing pattern |
| **Categories** | Country-specific (US: distribution, India: language/industry) | Matches how users conceptualize theatrical releases (US4) |
| **Archive Strategy** | Keep existing archive/ for historical data, add three-week model | Maintains backward compatibility, supports future archive browsing |
| **URL Hash Format** | `#last-week/{country}`, `#current/{country}`, `#next-week/{country}` | Intuitive, shareable, supports browser back/forward (US5) |
| **API Calls** | Fetch all three weeks in single GitHub Actions run | Atomic updates, consistent data, efficient API usage |
| **Week Transition** | Daily cron at 09:00 UTC, slides window forward | Automatic, reliable, maintains three-week invariant |

## Dependencies & Prerequisites

### External Dependencies
- **Perplexity API**: Required for fetching movie data (same as existing OTT implementation)
- **GitHub Actions**: Required for daily automated updates
- **Playwright**: Dev dependency for testing (already in package.json)

### Internal Dependencies  
- **Existing utilities**: date-utils.js, cache.js, error-handler.js (reuse as-is or with minor updates)
- **Existing workflows**: .github/workflows/update-deploy.yml (minor updates)
- **Existing tests**: Adapt patterns from tests/features/, tests/build/ directories

### Knowledge Prerequisites for Implementers
- Vanilla JavaScript ES6+ (no framework knowledge needed)
- Playwright Test Framework basics
- ISO 8601 week standard understanding
- GitHub Actions workflow syntax (for workflow updates)
- Perplexity API usage (existing code as reference)

## Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| API data quality inconsistent for movies | Medium | High | Iterative prompt engineering, validation rules, fallback to manual verification |
| Three-week model causes cache invalidation issues | Low | Medium | Reuse existing cache.js patterns (week-based caching already works) |
| Future week data unreliable (movies postponed) | High | Low | Mark next-week dates as "tentative", accept some inaccuracy |
| UI confusion between past/current/future | Medium | Medium | Clear visual indicators, week titles with dates, "Upcoming" badges |
| Performance regression with three files | Low | Low | Files are small (~50-150 movies), existing performance already excellent |

## Success Metrics (Implementation)

- [ ] All 20 functional requirements implemented and tested
- [ ] All 5 user stories have passing E2E tests
- [ ] Constitution compliance maintained (all 5 principles)
- [ ] Performance budgets met (FCP < 1.0s, LCP < 2.5s)
- [ ] Accessibility audit passes (score ≥ 90)
- [ ] Zero runtime dependencies maintained
- [ ] Progressive enhancement verified (works without JS)
- [ ] Daily automated updates working reliably

**Definition of Done**: Feature is ready for production when all success metrics pass and PR is approved.

---

## Appendix: File Modification Matrix

| File | Modification Type | Estimated LOC Change | Priority |
|------|------------------|---------------------|----------|
| `scripts/fetch-releases.js` | MAJOR | ~200 lines changed | P1 (Critical) |
| `assets/js/app.js` | MAJOR | ~150 lines changed | P1 (Critical) |
| `scripts/utils/week-transition.js` | MAJOR | ~100 lines changed | P1 (Critical) |
| `scripts/utils/date-utils.js` | MINOR | ~30 lines added | P1 (Critical) |
| `index.html` | MODERATE | ~50 lines changed | P1 (Critical) |
| `assets/css/main.css` | MINOR | ~30 lines changed | P2 (Important) |
| `.github/workflows/update-deploy.yml` | MINOR | ~10 lines changed | P2 (Important) |
| `data/{country}/last-week.json` | NEW | N/A (generated) | P1 (Critical) |
| `data/{country}/next-week.json` | NEW | N/A (generated) | P1 (Critical) |
| `tests/features/*.spec.ts` | NEW + UPDATES | ~500 lines total | P1 (Critical) |
| `tests/build/*.spec.ts` | UPDATES | ~100 lines changed | P2 (Important) |
| `tests/integration/*.spec.ts` | NEW | ~200 lines | P2 (Important) |

**Total Estimated Effort**: ~1,400 LOC changes across 15-20 files

---

**Plan Status**: ✅ **READY FOR IMPLEMENTATION**

All technical context clarified, constitution gates passed, research tasks defined. Ready to proceed with `/speckit.tasks` to generate detailed implementation tasks.
